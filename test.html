<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SmartInsTech</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>
	<script language="javascript" type="text/javascript" src="smartinstech-sc-test.js"></script>


</head>
<body>
    <div class="container">

        <h1>Add user</h1>

        <label for="fName" class="col-lg-2 control-label">First name</label>
        <input id="fName" type="text">

        <label for="lName" class="col-lg-2 control-label">Last name</label>
        <input id="lName" type="text">
		
		<label for="email" class="col-lg-2 control-label">Email</label>
        <input id="email" type="text">
		
		<label for="sAddress" class="col-lg-2 control-label">Address</label>
        <input id="sAddress" type="text">
		
		<label for="city" class="col-lg-2 control-label">City</label>
        <input id="city" type="text">
		
		<label for="postCode" class="col-lg-2 control-label">Postcode</label>
        <input id="postCode" type="text">
		
		<label for="country" class="col-lg-2 control-label">Country</label>
        <input id="country" type="text">
		
		<label for="TRR" class="col-lg-2 control-label">TRR</label>
        <input id="TRR" type="text">

        <button id="button">Add</button>
		
		<h2 id="user"></h2>
		<span id="userTrans"></span>
		<img id="loader" src="https://loading.io/spinners/double-ring/lg.double-ring-spinner.gif">


    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
	<script language="javascript" type="text/javascript" src="web3.js"></script>

    <script>
	
		var userEvent = SmartInsTech.NewUser({}, 'latest'); //local: Event(), ropsten: Event({}, 'latest')
		userEvent.watch(function(err, result){
            if (!err) {
				if (result.blockHash != $("#userTrans").html()) 
					$("#loader").hide();
					
				$("#userTrans").html('Block hash: ' +result.blockHash);
				$("#user").html('New user: ' + web3.toAscii(result.args.firstName) + ' ' + web3.toAscii(result.args.lastName));
			} else {
				$("#loader").hide();
			}
        });

        $("#button").click(function() {
		    $("#loader").show();
            SmartInsTech.createUser($("#fName").val(), $("#lName").val(), $("#email").val(), $("#sAddress").val(), 
			$("#city").val(), $("#postCode").val(), $("#country").val(), $("#TRR").val(), (err, res) => {
				if (err) {
					$("#loader").hide();
					console.log('Something went wrong!');
				}
			});
        });

    </script>

</body>
</html>